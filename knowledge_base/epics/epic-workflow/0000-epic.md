**Epic WF: Implement the Agent-Forge Workflow Framework**

**Epic Overview**

This epic delivers a fully operational workflow framework for Agent-Forge projects using AiderDesk. The framework defines a 14-phase epic lifecycle (RULES.md) driven by four human-run commands (`/turn-idea-into-epic`, `/get-feedback-on-epic`, `/finalize-epic`, `/implement-prd`) with all other actions delegated to agents internally. Today the AiderDesk `ror-agent-config` contains HomeKit-specific rules, missing command files, contradictory commit policies, and no linkage to the canonical RULES.md. This epic closes every gap so that a human can run the four commands end-to-end and agents execute the 14-phase workflow autonomously.

**User Capabilities**

- Run `/turn-idea-into-epic` to convert a raw idea into a structured epic with atomic PRD summaries.
- Run `/get-feedback-on-epic` to expand the epic and collect Architect feedback with automatic delegation.
- Run `/finalize-epic` to break out PRD files, build the implementation plan, and commit all artifacts.
- Run `/implement-prd` to execute the Blueprint inner loop (Plan → Architect Gate → Code → QA Gate → Log) with full agent delegation.

**Fit into Big Picture**

Agent-Forge orchestrates AI agents across multiple projects. The workflow framework is the process backbone — without it, agents operate ad-hoc with no quality gates, no consistent commit policy, and no traceability. This epic makes the workflow enforceable and repeatable for any project that uses the `ror-agent-config` bundle.

**Reference Documents**

- `knowledge_base/epics/instructions/RULES.md` — canonical 14-phase rules (created)
- `knowledge_base/epics/epic-workflow/workflow.md` — workflow definition
- `knowledge_base/epics/epic-workflow/how-to-use-workflow.md` — human usage guide
- `knowledge_base/epics/epic-workflow/prompt-definitions.md` — exact prompt text for all commands
- `knowledge_base/epics/epic-workflow/workflow-implementaion-plan.md` — detailed change list
- `knowledge_base/epics/epic-workflow/workflow-table-of-contence.md` — file inventory
- `agent-forge/knowledge_base/aider-desk/configs/ror-agent-config/` — source config bundle

---

### Key Decisions Locked In

**Architecture / Boundaries**

- Only four human-run commands exist in `commands/`. All other workflow steps are agent-internal (invoked via sub-agent delegation, not command files).
- `ror-agent-config/` is the single source for AiderDesk config. The sync script (`scripts/sync-aider-config.sh`) deploys to `.aider-desk/` at runtime.
- Agent IDs in command files use template format (`ror-architect`, `ror-qa`, etc.). The sync script appends `-<project>` at deploy time.
- `RULES.md` is the authoritative reference for phases, rubrics, templates, naming, and anti-patterns. All prompts reference it.

**Commit Policy**

- Commit plans always.
- Commit code when tests pass (green).
- This replaces the legacy "NEVER commit without explicit user confirmation" in `rails-base-rules.md`.

**Testing**

- Minitest is the default test framework everywhere. No RSpec.
- QA scoring uses the RULES.md Φ11 rubric (AC Compliance 30, Test Coverage 30, Code Quality 20, Plan Adherence 20).

**What Is Explicitly Out of Scope**

- Writing application code for any specific project (this epic is config/documentation only).
- Creating new agent types beyond the existing four (Architect, QA, Coding, Debug).
- Modifying the sync script itself.
- Creating the companion docs referenced by RULES.md (`implied-workflow.md`, `epic-prd-best-practices.md`).

---

### High-Level Scope & Non-Goals

**In scope**

- Create three missing human command files.
- Update `implement-prd.md` to enforce PRD plan adherence.
- Generalize `rails-base-rules.md` (remove HomeKit references).
- Fix commit policy across all config files.
- Update agent system prompts (QA → Minitest, Debug → strengthen).
- Update `delegation-rules.md` commit policy.
- Decide fate of legacy commands (`implement-plan.md`, `review-epic.md`, `audit-homekit.md`).
- Update utility commands with correct agent IDs.
- Validate no RSpec remnants.
- Update workflow documentation for consistency.
- Update Table of Contents.

**Non-goals / deferred**

- Runtime `.aider-desk/` files managed independently of the sync script (project-local agents like `translation-manager`, `test-writer`, etc.) are not touched.
- Splitting RULES.md into smaller files (deferred until size becomes a problem).
- Adding workflow metrics/retrospective tracking (deferred).
- Making the workflow framework-agnostic (currently Rails-specific by design).

---

### PRD Summary Table

| # | PRD Title | Summary | Dependencies |
|---|-----------|---------|--------------|
| WF-01 | Generalize Base Rules & Fix Commit Policy | Remove HomeKit references from `rails-base-rules.md`, update commit policy to "commit plans always; commit code when green", and propagate the policy to `delegation-rules.md` and agent system prompts. | None (blocking) |
| WF-02 | Create Human Command Files | Create `turn-idea-into-epic.md`, `get-feedback-on-epic.md`, and `finalize-epic.md` in `ror-agent-config/commands/` using prompt-definitions.md as source. | WF-01 |
| WF-03 | Update implement-prd and Legacy Commands | Update `implement-prd.md` to enforce PRD plan adherence and Blueprint loop. Repurpose `review-epic.md`, document `implement-plan.md` as internal-only, remove `audit-homekit.md`, fix agent IDs in utility commands. | WF-01 |
| WF-04 | Update Agent System Prompts | Add Minitest to QA agent prompt, strengthen Debug agent prompt, remove any HomeKit references from Coding agent prompt. | WF-01 |
| WF-05 | Validate & Align Documentation | Grep for RSpec remnants, confirm all docs are consistent with four-command model, update TOC, run validation checklist. | WF-01, WF-02, WF-03, WF-04 |

---

### Key Guidance for All PRDs in This Epic

- **Architecture**: All changes target `ror-agent-config/` source files. No `.aider-desk/` runtime files are edited directly.
- **Config Format**: Command files are Markdown. Agent configs are JSON. Follow existing patterns.
- **Prompt Source**: `prompt-definitions.md` is the authoritative source for command file content.
- **Agent IDs**: Use template IDs (`ror-architect`, `ror-qa`, `ror-debug`, `ror-rails`). Never use suffixed runtime IDs in source files.
- **Commit Policy**: Every file that mentions commits must say "commit plans always; commit code when green."
- **Testing Framework**: Every file that mentions testing must say Minitest (never RSpec).

---

### Implementation Status Tracking

- Create `0001-IMPLEMENTATION-STATUS.md` in this directory before starting PRD work.
- Update it after each PRD completion.

---

### Success Metrics

- All four human commands exist and contain correct prompt text referencing RULES.md.
- `rails-base-rules.md` contains zero HomeKit-specific references.
- Commit policy is identical across `rails-base-rules.md`, `delegation-rules.md`, all agent prompts, and `implement-prd.md`.
- No RSpec references remain in any config file.
- `workflow.md`, `how-to-use-workflow.md`, `prompt-definitions.md`, and TOC are mutually consistent.
- Validation checklist in `workflow-implementaion-plan.md` is 100% complete.

---

### Next Steps

1. Create `0001-IMPLEMENTATION-STATUS.md`
2. Proceed with PRD WF-01 (Generalize Base Rules & Fix Commit Policy)
3. PRDs WF-02, WF-03, WF-04 can proceed in parallel after WF-01
4. PRD WF-05 runs last as the validation pass

---

### Detailed PRDs

Full PRD specifications live in separate files:
- `PRD-WF-01-generalize-rules-commit-policy.md`
- `PRD-WF-02-create-human-commands.md`
- `PRD-WF-03-update-implement-prd-legacy-commands.md`
- `PRD-WF-04-update-agent-prompts.md`
- `PRD-WF-05-validate-align-documentation.md`
