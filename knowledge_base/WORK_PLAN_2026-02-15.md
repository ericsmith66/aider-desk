# Strategic Work Plan: Aider-Desk & Eureka Integration
**Date**: February 15, 2026

## üéØ Primary Objective: System Integration Excellence
The focus of this plan is to finalize the **foundational interface and workflow** between `aider-desk` and `eureka-homekit`. We are pivoting from "feature completion" to "systemic reliability" to ensure that agents can autonomously manage the HomeKit ecosystem with high integrity.

---

## üèóÔ∏è Phase 1: Integration Integrity (Eureka-Homekit)
*Ensuring the HomeKit control loop is secure, verifiable, and architecturally sound.*

### 1.1 Server-Side Command Safety (Deduplication)
**Target**: `eureka-homekit` (`PrefabControlService.rb`)
**Goal**: Implement the 10-second deduplication window for identical commands. This is the "Contract of Trust" between the UI and the hardware.
**Task**: Prevent API flooding. If a duplicate command is received within 10s, return `deduplicated: true` instead of executing.

### 1.2 Verifiable Integration (Controller Specs)
**Target**: `eureka-homekit` (`spec/controllers/accessories_controller_spec.rb`)
**Goal**: Create the missing integration tests that verify the full control flow (Single, Batch, and Deduplicated).
**Verification**: The system must be able to prove its own correctness under load.

---

## üß™ Phase 2: Orchestration & Workflow (Aider-Desk)
*Stabilizing how agents think, communicate, and follow orders.*

### 2.1 The "Vault Protocol" Stress Test
**Target**: `knowledge_base/test_plan/mock_project/`
**Goal**: Resolve the "Gate Bypass" and "Self-Audit Hallucination" patterns. This is critical for future autonomous maintenance of Eureka.
**Success Criteria**: The Lead Agent must successfully delegate to the QA subagent without skipping the gate.

### 2.2 Subagent Infrastructure Stabilization
**Goal**: Resolve the `aider` subagent hangs/crashes.
**Action**: Investigate logs in `~/.aider-desk/logs/`. Fix the process lifecycle management to handle multi-file generation without timeout.

### 2.3 Formalizing the Architect-to-Agent Loop
**Goal**: Implement a standard workflow for "Audit -> Refinement".
**Action**: Create a directive where agents are *blocked* from proceeding until all "RED FLAGS" in an Architect Audit are resolved.

---

## üñ•Ô∏è Phase 3: Platform Stability & UX (Aider-Desk)
*Fixing the tools the developer uses to manage the integration.*

### 3.1 Model Manager Refactor (Fail-Fast Loading)
**Target**: `src/main/models/model-manager.ts`
**Goal**: Replace `Promise.all` with a non-blocking pattern. The UI must populate models as they arrive, ensuring a slow provider (like Ollama) doesn't hang the entire developer experience.

### 3.2 Chat UI Fixes
**Goal**: Resolve the "Unselectable Models" issue in the chat interface.
**Action**: Audit the React state management in `ModelSelector.tsx` and `TaskBar.tsx`.

### 3.3 Change Review & Upstream PRs
**Goal**: Prepare the "Message index -2" and "Model selection" fixes for upstream submission. This ensures our local environment stays aligned with the core project.

---

## üö¶ Execution Guardrails
1.  **System First**: Every task must prioritize "How this improves the integration" over "Does this add a new button".
2.  **Direct Write**: Until subagent stability is verified, use `power---file_write` for large scaffolds.
3.  **Audit Enforcement**: No bypassing Phase Gates. If a model hallucinations an audit, the task must be stopped and the prompt hardened.

---
**Status**: Ready for execution.
**Focus**: Aider-Desk & Eureka Integration Foundations.
